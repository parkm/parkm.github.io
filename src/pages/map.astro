---
export const title = "Site Map";
export const description = "All pages on the site";
export const icon = "ðŸ—ºï¸";

import Layout from "src/layouts/Layout.astro";

const modules = import.meta.glob("/src/pages/**/*.astro", { eager: true });

type PageModule = {
  title?: string;
  description?: string;
  icon?: string;
}

let links = [...Object.keys(modules)
    .filter(
      (filePath) =>
        !/\/index\.astro$/.test(filePath) || filePath === "/src/pages/index.astro"
    )
    .map((filePath) => {
      const module = modules[filePath] as PageModule;
      const href =
        filePath
          .replace("/src/pages", "")
          .replace(/index\.astro$/, "")
          .replace(/\.astro$/, "")
          .replace(/\/$/, "") || "/";
      const isRoot = filePath === "/src/pages/index.astro";

      const fallbackTitle =
        isRoot
          ? "Root"
          : (filePath
              .split("/")
              .pop()
              ?.replace(".astro", "")
              .replace(/-/g, " ")
              .replace(/\b\w/g, (c) => c.toUpperCase()) ?? "");

      const pageTitle = module.title || fallbackTitle;
      const pageDescription = module.description;
      const pageIcon = module.icon;

      return { href, title: pageTitle, description: pageDescription, icon: pageIcon, isRoot };
    }),
    { href: "/partygif", title: "PartyGif", description: "Create party gifs client-side", icon: "ðŸŽ‰", isRoot: false },
  ]
  .toSorted((a, b) => {
    if (a.isRoot) return -1;
    if (b.isRoot) return 1;
    return a.title.localeCompare(b.title);
  });
---

<Layout title={title} description={description}>
  <main class="min-h-screen px-6 py-20 bg-[#13151a] text-[#e5e5e5]">
    <header class="text-center mb-12">
      <h1 class="text-4xl font-bold mb-2 text-white">Site Map</h1>
    </header>

    <ul class="grid gap-4 sm:grid-cols-2 md:grid-cols-3 max-w-4xl mx-auto">
      {
        links.map(({ href, title, description, icon, isRoot }) => (
          <li>
            <a
              href={href}
              class="block rounded-lg border border-[var(--border-color)] bg-[#1b1d24]
                   hover:bg-[#22242c]
                   transition-colors py-6 px-4 font-medium text-white h-full
                   flex flex-col items-center justify-center gap-2"
            >
              {icon && <span class="text-4xl" aria-hidden="true">{icon}</span>}
              <span class="text-lg font-semibold">{isRoot ? "Home" : title}</span>
              {description && (
                <span class="text-sm text-gray-400 text-center mt-1">
                  {isRoot ? "" : description}
                </span>
              )}
            </a>
          </li>
        ))
      }
    </ul>
  </main>
</Layout>
